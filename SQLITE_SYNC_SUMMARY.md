# SQLite –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

## ‚úÖ –©–æ –≤–∂–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:

### 1. **–í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ SQLite**
- ‚úÖ –¢–∞–±–ª–∏—Ü—è `deliveries` - –≤—Å—ñ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü—è `delivery_history` - —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤
- ‚úÖ –¢–∞–±–ª–∏—Ü—è `settings` - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É
- ‚úÖ –¢–∞–±–ª–∏—Ü—è `sync_queue` - —á–µ—Ä–≥–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ API

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ API**
- ‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ SQLite –∑–∞–≤–∂–¥–∏
- ‚úÖ –ö–æ–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–∞—î "delivered", –∞–¥—Ä–µ—Å–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ API
- ‚úÖ –Ø–∫—â–æ –Ω–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É ‚Üí –∞–¥—Ä–µ—Å–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `sync_queue`
- ‚úÖ –ö–æ–ª–∏ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∑'—è–≤–ª—è—î—Ç—å—Å—è ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –≤—Å—ñ –æ—á—ñ–∫—É—é—á—ñ –∑–∞–ø–∏—Å–∏

## üîÑ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î –¥–æ—Å—Ç–∞–≤–∫—É
    ‚Üì
storageService.saveDelivery() 
    ‚Üì
deliveryQueries.saveDelivery() ‚Üí SQLite (—Ç–∞–±–ª–∏—Ü—è deliveries)
    ‚Üì
‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ª–æ–∫–∞–ª—å–Ω–æ
```

### –ö—Ä–æ–∫ 2: –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–∞ API –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤—Ü—ñ
```
–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Üí "delivered"
    ‚Üì
deliveryService.updateDeliveryStatus()
    ‚Üì
sendDeliveryToApi(address, deliveryId)
    ‚Üì
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É (syncService.isConnected())
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –Ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç    ‚îÇ  –ù–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É ‚îÇ
‚îÇ        ‚Üì        ‚îÇ        ‚Üì         ‚îÇ
‚îÇ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞   ‚îÇ  –ó–±–µ—Ä–µ–≥—Ç–∏ –≤      ‚îÇ
‚îÇ API –æ–¥—Ä–∞–∑—É      ‚îÇ  sync_queue      ‚îÇ
‚îÇ        ‚Üì        ‚îÇ        ‚Üì         ‚îÇ
‚îÇ   ‚úÖ –£—Å–ø—ñ—Ö      ‚îÇ  –û—á—ñ–∫—É–≤–∞–Ω–Ω—è...   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö—Ä–æ–∫ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –ø–æ—è–≤—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
```
–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –∑'—è–≤–ª—è—î—Ç—å—Å—è
    ‚Üì
syncService –≤–∏—è–≤–ª—è—î –∑–º—ñ–Ω—É (NetInfo listener)
    ‚Üì
syncService.syncPendingItems()
    ‚Üì
–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ sync_queue (synced = 0)
    ‚Üì
–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É:
  - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ API
  - –Ø–∫—â–æ —É—Å–ø—ñ—Ö ‚Üí markAsSynced(1)
  - –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ ‚Üí updateRetry() + —Å–ø—Ä–æ–±–∞ –∑–Ω–æ–≤—É
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö SQLite:

### –¢–∞–±–ª–∏—Ü—è `deliveries`
```sql
CREATE TABLE deliveries (
  id TEXT PRIMARY KEY,
  trackingNumber TEXT NOT NULL,
  status TEXT NOT NULL,
  createdAt INTEGER NOT NULL,
  updatedAt INTEGER NOT NULL,
  estimatedDelivery INTEGER,
  currentLocation TEXT,
  recipient TEXT,
  address TEXT,
  rating INTEGER,
  review TEXT
);
```

### –¢–∞–±–ª–∏—Ü—è `sync_queue`
```sql
CREATE TABLE sync_queue (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  address TEXT NOT NULL,
  deliveryId TEXT,
  createdAt INTEGER NOT NULL,
  retryCount INTEGER DEFAULT 0,
  lastError TEXT,
  synced INTEGER DEFAULT 0  -- 0 = –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ, 1 = —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ
);
```

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏ —Å–∏—Å—Ç–µ–º–∏:

1. **–û—Ñ–ª–∞–π–Ω-–ø–µ—Ä—à–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞**
   - –î–∞–Ω—ñ –∑–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - –ü—Ä–∞—Ü—é—î –±–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
   - –ù–µ–º–∞—î –≤—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è**
   - –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
   - –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ
   - –í—ñ–¥—Å—Ç–µ–∂—É—î –ø–æ—è–≤—É —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

3. **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**
   - –ü–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö (–¥–æ 5 —Å–ø—Ä–æ–±)
   - –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ (–ø—ñ—Å–ª—è 7 –¥–Ω—ñ–≤)

## üîç –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:

–£ –∫–æ–Ω—Å–æ–ª—ñ –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏:
- `üì• Added to sync queue: [address]` - –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≤ —á–µ—Ä–≥—É
- `üîÑ Syncing N pending items...` - –ø–æ—á–∞—Ç–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- `‚úÖ Synced item N` - —É—Å–ø—ñ—à–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
- `üåê Network state changed: ONLINE/OFFLINE` - –∑–º—ñ–Ω–∞ —Å—Ç–∞–Ω—É —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- `üì¥ No internet, saving to sync queue` - –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ SQLite)
```typescript
const delivery = await deliveryService.createDelivery('TRACK123');
// ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤ SQLite
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ API)
```typescript
await deliveryService.updateDeliveryStatus(deliveryId, 'delivered');
// ‚úÖ –Ø–∫—â–æ —î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Üí –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ API
// ‚úÖ –Ø–∫—â–æ –Ω–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ sync_queue
```

### –†—É—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
```typescript
import { syncService } from './src/services/syncService';
await syncService.syncPendingItems();
```

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±**: 5
- **–¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Ç—É**: 10 —Å–µ–∫—É–Ω–¥
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É**: –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è**: –ø—Ä–∏ –ø–æ—è–≤—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É (–∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é 2 —Å–µ–∫—É–Ω–¥–∏)
- **–û—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –∑–∞–ø–∏—Å—ñ–≤**: —Å—Ç–∞—Ä—ñ—à—ñ –∑–∞ 7 –¥–Ω—ñ–≤

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫:

–í—Å—ñ –¥–∞–Ω—ñ **–∑–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ SQLite**, –∞ –∫–æ–ª–∏ –∑'—è–≤–ª—è—î—Ç—å—Å—è —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç, –≤–æ–Ω–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –Ω–∞ API**. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –ø–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥—ñ–π –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

